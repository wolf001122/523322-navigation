<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>网址导航 - 实用的资源导航综合网站</title>
  <link rel="stylesheet" href="style.css">

  <!-- Google AdSense 核心脚本 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9474229114991789"
          crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <h1>网址导航 <small>— 实用的资源导航综合网站</small></h1>

    <!-- 广告位 1：顶部横幅 -->
    <div class="ad-top">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-9474229114991789"
           data-ad-format="auto"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>

    <!-- 搜索框 -->
    <input type="text" id="searchInput" placeholder="搜索网站名称或描述..." autocomplete="off" style="width:300px;padding:8px;margin:10px auto;display:block;">
  </header>

  <main id="navContainer">
    <!-- 动态加载占位 -->
    <p style="text-align:center; color:#666;">加载中...</p>
  </main>

  <!-- 广告位 2：侧边矩形 -->
  <div class="ad-side">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-9474229114991789"
         data-ad-format="auto"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>

  <footer>
    © 2025 网址导航站
  </footer>

  <script>
    // 动态从 KV 加载数据
    async function loadData() {
      try {
        const res = await fetch('/api/data');
        const xml = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, 'text/xml');
        const categories = Array.from(doc.querySelectorAll('category'));
        const container = document.getElementById('navContainer');
        container.innerHTML = '';

        categories.forEach(cat => {
          const name = cat.getAttribute('name');
          const div = document.createElement('div');
          div.className = 'category';
          div.innerHTML = `<h2>${name}</h2><ul class="link-list"></ul>`;
          const ul = div.querySelector('.link-list');

          cat.querySelectorAll('link').forEach(link => {
            const a = document.createElement('a');
            a.href = link.getAttribute('url');
            a.target = '_blank';
            a.textContent = link.getAttribute('name');
            const li = document.createElement('li');
            li.appendChild(a);
            const desc = link.getAttribute('desc');
            if (desc) {
              const span = document.createElement('span');
              span.className = 'desc';
              span.textContent = desc;
              li.appendChild(span);
            }
            ul.appendChild(li);
          });

          container.appendChild(div);
        });

        // 搜索功能
        document.getElementById('searchInput').oninput = e => {
          const term = e.target.value.toLowerCase();
          document.querySelectorAll('.link-list li').forEach(li => {
            li.style.display = li.textContent.toLowerCase().includes(term) ? 'flex' : 'none';
          });
        };

      } catch (e) {
        document.getElementById('navContainer').innerHTML = '<p style="text-align:center;color:red;">加载失败，请稍后重试</p>';
        console.error(e);
      }
    }

    // 页面加载时执行
    loadData();
  </script>
</body>
</html>

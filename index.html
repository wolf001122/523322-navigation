<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>导航</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="icon" href="/favicon.ico" type="image/x-icon">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9474229114991789" crossorigin="anonymous"></script>
<style>
/* ======== CSS 变量与基础重置 ======== */
:root {
  --primary: #1a73e8;
  --primary-hover: #1557b0;
  --bg: #f8f9fa;
  --card-bg: #ffffff;
  --text: #202124;
  --text-light: #5f6368;
  --border: #dadce0;
  --shadow-sm: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
  --shadow-md: 0 4px 12px rgba(0,0,0,.1);
  --transition: all 0.25s ease;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

/* ======== 整体布局 ======== */
#layout { display: flex; height: 100vh; width: 100vw; }
#main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

/* ======== 侧边栏 ======== */
#sidebar {
  width: 260px;
  background: var(--card-bg);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s ease;
  z-index: 200;
}
#logo {
  padding: 32px 20px;
  font-size: 28px;
  font-weight: 700;
  text-align: center;
  color: var(--primary);
  border-bottom: 1px solid var(--border);
  cursor: default;
  transition: var(--transition);
}
#logo.return-mode { color: var(--primary); cursor: pointer; }
#logo.return-mode:hover { opacity: 0.85; }
#logo.return-mode::after {
  content: '返回搜索首页';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 13px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
#logo.return-mode:hover::after { opacity: 1; }

#cats { flex: 1; overflow-y: auto; padding: 12px 0; }
.cat {
  padding: 16px 32px;
  cursor: pointer;
  font-size: 15.5px;
  color: var(--text);
  transition: var(--transition);
}
.cat:hover { background: #f1f3f4; }
.cat.active {
  background: var(--primary);
  color: #fff;
  font-weight: 600;
}

#side-bottom {
  border-top: 1px solid var(--border);
  padding: 24px 32px;
  font-size: 14.5px;
  color: var(--text-light);
}
#side-bottom div {
  margin-bottom: 16px;
  cursor: pointer;
  transition: color 0.2s;
}
#side-bottom div:hover { color: var(--primary); }

/* ======== 移动端 ======== */
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 199;
}
#hamburger {
  display: none;
  position: fixed;
  top: 20px;
  left: 20px;
  width: 32px;
  height: 24px;
  cursor: pointer;
  flex-direction: column;
  justify-content: space-between;
  z-index: 201;
}
#hamburger span {
  display: block;
  height: 4px;
  background: var(--text);
  border-radius: 2px;
  transition: var(--transition);
}
@media (max-width: 868px) {
  #sidebar { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); width: 280px; }
  #sidebar.visible { transform: translateX(0); }
  #hamburger { display: flex; }
  body.sidebar-open #overlay { display: block; }
  #ad-top { padding-left: 64px; }
  #search-page { padding-top: 80px; }
}

/* ======== 主内容区 ======== */
#ad-top {
  background: var(--card-bg);
  border-bottom: 1px solid var(--border);
  padding: 16px;
  text-align: center;
  box-shadow: var(--shadow-sm);
}
#content { flex: 1; overflow: auto; padding: 32px; background: var(--bg); }

/* ======== 首页搜索区 ======== */
#search-page {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 40px;
  animation: fadeUp 0.7s ease;
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(24px); }
  to { opacity: 1; transform: none; }
}
#search-box {
  display: flex;
  width: 100%;
  max-width: 760px;
  border-radius: 32px;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(0,0,0,0.12);
}
#search-box input {
  flex: 1;
  padding: 20px 28px;
  font-size: 19px;
  border: none;
  outline: none;
  background: var(--card-bg);
}
#search-box input:focus { box-shadow: 0 0 0 4px rgba(26,115,232,0.18); }
#search-box button {
  padding: 0 36px;
  background: var(--primary);
  color: #fff;
  border: none;
  font-size: 17px;
  cursor: pointer;
  transition: var(--transition);
}
#search-box button:hover { background: var(--primary-hover); }

#engines {
  margin-top: 36px;
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  justify-content: center;
}
#engines button {
  padding: 12px 28px;
  border: 1px solid var(--border);
  background: var(--card-bg);
  border-radius: 28px;
  cursor: pointer;
  font-size: 15px;
  transition: var(--transition);
}
#engines button:hover { background: #f1f3f4; box-shadow: var(--shadow-sm); }
#engines button.active {
  background: #e8f0fe;
  border-color: var(--primary);
  color: var(--primary);
  font-weight: 600;
}

/* ======== 分类页面 ======== */
.category-title {
  font-size: 34px;
  font-weight: 600;
  margin-bottom: 16px;
}
.sub-title {
  font-size: 21px;
  color: var(--primary);
  margin: 40px 0 16px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--primary);
}
.links {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 24px;
}
.card {
  display: flex;
  align-items: center;
  padding: 20px;
  background: var(--card-bg);
  border-radius: 16px;
  text-decoration: none;
  color: inherit;
  height: 110px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  transition: var(--transition);
  overflow: hidden;
}
.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 28px rgba(0,0,0,0.15);
}
.card img {
  width: 56px;
  height: 56px;
  min-width: 56px;
  object-fit: contain;
  background: var(--bg);
  border-radius: 12px;
  padding: 6px;
}
.text {
  margin-left: 18px;
  overflow: hidden;
  flex: 1;
}
.name {
  font-size: 16px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.desc {
  font-size: 13.5px;
  color: var(--text-light);
  margin-top: 6px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.ad-box {
  margin: 48px 0;
  padding: 28px;
  background: var(--card-bg);
  border: 1px solid var(--border);
  border-radius: 16px;
  text-align: center;
  box-shadow: var(--shadow-sm);
}
iframe#external-frame { flex: 1; width: 100%; border: none; }
</style>
</head>
<body>
<div id="layout">
  <div id="sidebar">
    <div id="logo" onclick="backToSearch()">导　航</div>
    <div id="cats"></div>
    <div id="side-bottom">
      <div onclick="loadExternal('/submit.html')">网站提交</div>
      <div onclick="loadExternal('/privacy.html')">隐私政策</div>
      <div onclick="loadExternal('/links.html')">友情链接</div>
      <div onclick="loadExternal('/about.html')">关于导航</div>
    </div>
  </div>
  <div id="main">
    <div id="overlay" onclick="toggleSidebar()"></div>
    <div id="hamburger" onclick="toggleSidebar()">
      <span></span><span></span><span></span>
    </div>
    <div id="ad-top">
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9474229114991789" data-ad-slot="1234567890" data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    <div id="search-page">
      <div id="search-box">
        <input id="q" placeholder="搜索…" onkeydown="if(event.key==='Enter')go()">
        <button onclick="go()">搜索</button>
      </div>
      <div id="engines">
        <button class="active" onclick="setEngine(this,'https://www.google.com/search?q=')">Google</button>
        <button onclick="setEngine(this,'https://www.baidu.com/s?wd=')">百度</button>
        <button onclick="setEngine(this,'https://www.bing.com/search?q=')">Bing</button>
      </div>
    </div>
    <div id="content"></div>
  </div>
</div>

<script>
// ======== 精简、优化后的 JS（功能完全一致，无任何丢失） ========
const API = '/api/data';
const DEF_ICON = '/icons/gray.png';
let engine = 'https://www.google.com/search?q=';
let data = [];
let xmlDoc = null;
const categoryCache = new Map();

function getDomain(url) {
  try {
    const hostname = new URL(url).hostname;
    return hostname.startsWith('www.') ? hostname.slice(4) : hostname;
  } catch { return 'example.com'; }
}

fetch(API)
  .then(r => r.text())
  .then(text => {
    xmlDoc = new DOMParser().parseFromString(text, 'text/xml');
    data = [...xmlDoc.querySelectorAll('category')].map(c => ({
      name: c.getAttribute('name'),
      subs: [...c.querySelectorAll('subcategory')].map(s => ({
        name: s.getAttribute('name'),
        links: [...s.querySelectorAll('link')].map(l => ({
          name: l.getAttribute('name'),
          url: l.getAttribute('url'),
          desc: l.getAttribute('desc') || '',
          icon: l.getAttribute('icon') || ''
        }))
      }))
    }));
    renderCats();
    backToSearch();
  });

function renderCats() {
  const box = document.getElementById('cats');
  box.innerHTML = '';
  data.forEach((cat, idx) => {
    const el = document.createElement('div');
    el.className = 'cat';
    el.textContent = cat.name;
    el.onclick = () => {
      document.querySelectorAll('.cat').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
      loadCategory(idx);
    };
    box.appendChild(el);
  });
}

function loadCategory(idx) {
  if (categoryCache.has(idx)) {
    showCategory(categoryCache.get(idx));
    return;
  }
  const node = xmlDoc.querySelectorAll('category')[idx];
  const catData = {
    name: node.getAttribute('name'),
    subs: [...node.querySelectorAll('subcategory')].map(s => ({
      name: s.getAttribute('name'),
      links: [...s.querySelectorAll('link')].map(l => ({
        name: l.getAttribute('name'),
        url: l.getAttribute('url'),
        desc: l.getAttribute('desc') || '',
        icon: l.getAttribute('icon') || ''
      }))
    }))
  };
  categoryCache.set(idx, catData);
  showCategory(catData);
}

function showCategory(cat) {
  document.getElementById('search-page').style.display = 'none';
  const cont = document.getElementById('content');
  cont.style.display = 'block';
  cont.innerHTML = `<div class="category-title">${cat.name}</div>
    <div class="ad-box"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9474229114991789" data-ad-slot="9876543210" data-ad-format="auto"></ins></div>`;
  (adsbygoogle = window.adsbygoogle || []).push({});

  cat.subs.forEach((sub, i) => {
    if (!sub.links.length) return;
    cont.innerHTML += `<div class="sub-title">${sub.name}</div><div class="links"></div>`;
    const linksBox = cont.lastElementChild.previousElementSibling;
    sub.links.forEach(link => {
      const a = document.createElement('a');
      a.className = 'card';
      a.href = link.url;
      a.target = '_blank';

      const img = document.createElement('img');
      const favicon = link.icon.trim() || `https://www.google.com/s2/favicons?sz=64&domain=${getDomain(link.url)}`;
      img.src = favicon;
      img.onerror = () => { img.src = DEF_ICON; };

      const textDiv = document.createElement('div');
      textDiv.className = 'text';
      textDiv.innerHTML = `<div class="name">${link.name}</div><div class="desc">${link.desc}</div>`;

      a.append(img, textDiv);
      linksBox.appendChild(a);
    });
  });
  document.getElementById('logo').classList.add('return-mode');
  closeSidebarOnMobile();
}

function backToSearch() {
  document.getElementById('content').style.display = 'none';
  document.getElementById('search-page').style.display = 'flex';
  document.getElementById('logo').classList.remove('return-mode');
  document.querySelectorAll('.cat').forEach(c => c.classList.remove('active'));
  closeSidebarOnMobile();
}

function go() {
  const q = document.getElementById('q').value.trim();
  if (q) window.open(engine + encodeURIComponent(q), '_blank');
}

function setEngine(btn, url) {
  engine = url;
  document.querySelectorAll('#engines button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function loadExternal(url) {
  document.getElementById('search-page').style.display = 'none';
  const cont = document.getElementById('content');
  cont.innerHTML = '<iframe id="external-frame" src="' + url + '"></iframe>';
  cont.style.display = 'flex';
  document.getElementById('logo').classList.add('return-mode');
  document.querySelectorAll('.cat').forEach(c => c.classList.remove('active'));
  closeSidebarOnMobile();
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('visible');
  document.body.classList.toggle('sidebar-open');
}

function closeSidebarOnMobile() {
  if (window.innerWidth <= 868) {
    document.getElementById('sidebar').classList.remove('visible');
    document.body.classList.remove('sidebar-open');
  }
}
</script>
</body>
</html>

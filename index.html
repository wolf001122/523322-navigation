<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>导航</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="google-adsense-account" content="ca-pub-9474229114991789">

<script async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9474229114991789"
  crossorigin="anonymous"></script>

<noscript>
  <div style="padding:12px;text-align:center;background:#fff3cd">
    本站需要 JavaScript 才能正常使用
  </div>
</noscript>

<style>
/* ===== 原有样式，基本未动 ===== */
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  background:#f8f9fa;
  color:#202124;
  height:100vh;
  overflow:hidden;
}
#layout{display:flex;height:100vh;width:100vw}

/* 左侧 */
#sidebar{
  width:240px;background:#fff;border-right:1px solid #dadce0;
  display:flex;flex-direction:column;
}
#logo{
  padding:24px 20px;font-size:24px;font-weight:700;
  text-align:center;color:#5f6368;border-bottom:1px solid #dadce0;
}
#cats{flex:1;overflow-y:auto;padding:8px 0}
.cat{
  padding:14px 24px;cursor:pointer;font-size:15px;
}
.cat:hover{background:#f1f3f4}
.cat.active{
  background:#e8f0fe;color:#1a73e8;font-weight:500;
}
#side-bottom{
  border-top:1px solid #dadce0;
  padding:16px 24px;font-size:14px;
}
#side-bottom div{margin-bottom:8px;cursor:pointer}
#side-bottom div:hover{color:#1a73e8}

/* 主区 */
#main{flex:1;overflow-y:auto;background:#f8f9fa}
#ad-top{
  background:#fff;border-bottom:1px solid #dadce0;
  padding:12px;text-align:center;
}

/* 搜索 */
#search-page{
  height:calc(100vh - 60px);
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
}
#search-box{width:100%;max-width:680px}
#search-box input{
  width:100%;padding:16px 20px;font-size:18px;
  border:1px solid #dadce0;border-radius:28px;
}
#engines{
  margin-top:20px;display:flex;justify-content:center;
  gap:12px;flex-wrap:wrap;
}
#engines button{
  padding:10px 20px;border:1px solid #dadce0;
  background:#fff;border-radius:24px;
}
#engines button.active{
  background:#e8f0fe;border-color:#1a73e8;color:#1a73e8;
}
#search-action{
  margin-top:16px;text-align:center;
}
#search-action button{
  padding:10px 32px;border-radius:24px;
  border:none;background:#1a73e8;color:#fff;
  font-size:15px;cursor:pointer;
}

/* 分类内容 */
#content{padding:24px;display:none}
.back{margin-bottom:16px;color:#1a73e8;cursor:pointer}
.category-title{font-size:28px;margin-bottom:8px}
.sub-title{font-size:18px;margin:24px 0 12px}

/* 卡片 */
.links{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:16px;
}
.card{
  display:flex;align-items:center;
  padding:16px;background:#fff;border-radius:12px;
  text-decoration:none;color:inherit;
}
.card img{width:48px;height:48px;margin-right:16px}

/* 弹窗 */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:none;align-items:center;justify-content:center;
  z-index:999;
}
.modal-box{
  width:420px;background:#fff;
  padding:24px;border-radius:12px;
}
.modal-box input,.modal-box textarea{
  width:100%;padding:10px;margin:8px 0;
}
</style>
</head>

<body>
<div id="layout">
  <div id="sidebar">
    <div id="logo">导　航</div>
    <div id="cats"></div>
    <div id="side-bottom">
      <div onclick="openSubmit()">网站提交</div>
      <div onclick="openLinks()">友情链接</div>
      <div onclick="openAbout()">关于导航</div>
    </div>
  </div>

  <div id="main">
    <div id="ad-top">
      <ins class="adsbygoogle" style="display:block"
        data-ad-client="ca-pub-9474229114991789"
        data-ad-slot="1234567890"
        data-ad-format="auto"></ins>
      <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>
    </div>

    <!-- 搜索页 -->
    <div id="search-page">
      <div id="search-box">
        <input id="q" placeholder="搜索…" onkeydown="if(event.key==='Enter')go()">
        <div id="engines">
          <button class="active" onclick="setEngine(this,'https://www.google.com/search?q=')">Google</button>
          <button onclick="setEngine(this,'https://www.baidu.com/s?wd=')">百度</button>
          <button onclick="setEngine(this,'https://www.bing.com/search?q=')">Bing</button>
        </div>
        <div id="search-action">
          <button onclick="go()">搜索</button>
        </div>
      </div>
    </div>

    <div id="content"></div>
  </div>
</div>

<!-- 网站提交 -->
<div class="modal" id="submitModal">
  <div class="modal-box">
    <h3>提交网站</h3>
    <input id="s-name" placeholder="网站名称">
    <input id="s-url" placeholder="https://">
    <textarea id="s-desc" placeholder="简介（30字内）"></textarea>
    <input id="s-honey" style="display:none">
    <input id="s-check" placeholder="验证：5 + 5 = ?">
    <button onclick="submitSite()">提交</button>
    <button onclick="closeModal()">取消</button>
  </div>
</div>

<script>
/* ===== 原有核心逻辑：完全保留 ===== */
const API='/api/data';
const DEF_ICON='/icons/default.png';
let engine='https://www.google.com/search?q=';
let data;

fetch(API).then(r=>r.text()).then(t=>{
  const xml=new DOMParser().parseFromString(t,'text/xml');
  data=[...xml.querySelectorAll('category')].map(c=>({
    name:c.getAttribute('name'),
    subs:[...c.querySelectorAll('subcategory')].map(s=>({
      name:s.getAttribute('name'),
      links:[...s.querySelectorAll('link')].map(l=>({
        name:l.getAttribute('name'),
        url:l.getAttribute('url'),
        desc:l.getAttribute('desc'),
        icon:l.getAttribute('icon')
      }))
    }))
  }));
  renderCats();
});

function renderCats(){
  const box=document.getElementById('cats');
  box.innerHTML='';
  data.forEach(c=>{
    const d=document.createElement('div');
    d.className='cat';
    d.textContent=c.name;
    d.onclick=()=>showCategory(c,d);
    box.appendChild(d);
  });
}

/* 搜索 */
function setEngine(btn,url){
  engine=url;
  document.querySelectorAll('#engines button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
}
function go(){
  const q=document.getElementById('q').value.trim();
  if(q)location.href=engine+encodeURIComponent(q);
}

/* 分类 */
function showCategory(c,el){
  document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));
  el.classList.add('active');
  window.scrollTo(0,0);

  document.getElementById('search-page').style.display='none';
  const cont=document.getElementById('content');
  cont.style.display='block';
  cont.innerHTML=`<div class="back" onclick="back()">← 返回搜索</div>
    <div class="category-title">${c.name}</div>`;

  c.subs.forEach((s,i)=>{
    if(!s.links.length)return;
    cont.innerHTML+=`<div class="sub-title">${s.name}</div><div class="links" id="l${i}"></div>`;
    const box=document.getElementById('l'+i);
    s.links.forEach(l=>{
      const a=document.createElement('a');
      a.className='card';
      a.href=l.url;a.target='_blank';
      const img=document.createElement('img');
      img.src=l.icon||DEF_ICON;
      img.onerror=()=>img.src=DEF_ICON;
      a.appendChild(img);
      a.innerHTML+=`<div><div>${l.name}</div><div>${l.desc||''}</div></div>`;
      box.appendChild(a);
    });
  });
}
function back(){
  document.getElementById('content').style.display='none';
  document.getElementById('search-page').style.display='flex';
  document.querySelectorAll('.cat').forEach(x=>x.classList.remove('active'));
}

/* 网站提交 */
let openTime=0;
const bad=/博彩|赌场|娱乐城|SEO|私服|VPN/i;

function openSubmit(){
  openTime=Date.now();
  document.getElementById('submitModal').style.display='flex';
}
function closeModal(){
  document.querySelectorAll('.modal').forEach(m=>m.style.display='none');
}
function submitSite(){
  if(Date.now()-openTime<4000)return alert('提交过快');
  if(s-honey.value)return;
  if(s-check.value!='10')return alert('验证失败');
  if(bad.test(s-name.value+s-desc.value))return alert('包含违规内容');

  fetch('/links_submit',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      name:s-name.value,
      url:s-url.value,
      desc:s-desc.value
    })
  }).then(r=>{
    alert(r.ok?'提交成功，等待审核':'提交失败');
  });

  closeModal();
}

function openLinks(){alert('友情链接请联系管理员')}
function openAbout(){alert('关于导航：简洁、纯净的网址导航')}
</script>
</body>
</html>

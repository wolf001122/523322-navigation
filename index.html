<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>导航 - 实用资源站</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9474229114991789"
          crossorigin="anonymous"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; font-family: 'Roboto', sans-serif; background: #f1f3f4; display: flex; height: 100vh; overflow: hidden; }
    a { text-decoration: none; }

    /* 左侧导航栏 */
    .sidebar {
      width: 256px;
      background: #fff;
      box-shadow: 2px 0 8px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100%;
      overflow: hidden;
      z-index: 10;
    }
    .sidebar-header {
      padding: 24px 16px;
      font-size: 20px;
      color: #5f6368;
      border-bottom: 1px solid #e0e0e0;
      text-align: center;
      font-weight: 500;
      cursor: pointer;
    }
    .sidebar-header:hover {
      background: #f1f3f4;
    }
    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }
    .sidebar-nav a {
      display: flex;
      align-items: center;
      padding: 12px 24px;
      color: #5f6368;
      font-size: 14px;
      transition: background 0.2s;
    }
    .sidebar-nav a:hover {
      background: #f1f3f4;
    }
    .sidebar-nav a.active {
      background: #e8f0fe;
      color: #4285f4;
      font-weight: 500;
    }
    .sidebar-nav a .material-icons {
      font-size: 24px;
      margin-right: 24px;
      color: #5f6368;
    }
    .sidebar-nav a.active .material-icons {
      color: #4285f4;
    }

    /* 底部固定菜单 */
    .sidebar-footer {
      border-top: 1px solid #e0e0e0;
      padding: 16px 0;
      background: #fff;
    }
    .sidebar-footer a {
      display: flex;
      align-items: center;
      padding: 12px 24px;
      color: #d93025;
      font-size: 14px;
    }
    .sidebar-footer a:hover {
      background: #fce8e6;
    }
    .sidebar-footer a .material-icons {
      margin-right: 24px;
      font-size: 24px;
    }

    /* 主内容区 */
    .main {
      margin-left: 256px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .top-bar {
      height: 64px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 24px;
    }
    .top-ad {
      width: 728px;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .content {
      flex: 1;
      overflow-y: auto;
      padding: 40px;
      background: #f1f3f4;
    }

    /* 搜索首页 */
    .search-home {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      min-height: 500px;
    }
    .search-box {
      width: 70%;
      max-width: 900px;
      display: flex;
      background: white;
      border-radius: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      overflow: hidden;
    }
    .search-input {
      flex: 1;
      padding: 24px;
      font-size: 22px;
      border: none;
      outline: none;
    }
    .search-select {
      padding: 24px;
      font-size: 18px;
      border: none;
      border-left: 1px solid #eee;
      background: white;
    }
    .search-btn {
      padding: 0 48px;
      background: #4285f4;
      color: white;
      font-size: 20px;
      border: none;
      cursor: pointer;
    }
    .search-btn:hover {
      background: #3367d6;
    }

    /* 分类内容 */
    .subcategory-title {
      font-size: 22px;
      color: #4285f4;
      margin: 50px 0 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }
    .links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 24px;
    }
    .link-card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: 160px;
      transition: transform 0.3s, box-shadow 0.3s;
      overflow: hidden;
    }
    .link-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    }
    .link-card img {
      width: 48px;
      height: 48px;
      object-fit: contain;
      border-radius: 8px;
      flex-shrink: 0;
    }
    .link-card a {
      font-size: 18px;
      font-weight: 500;
      color: #333;
      flex-shrink: 0;
    }
    .link-card a:hover {
      color: #4285f4;
    }
    .link-card .desc {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* 右侧广告 */
    .right-ad {
      position: fixed;
      right: 24px;
      top: 100px;
      width: 300px;
      height: 600px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      border-radius: 12px;
      overflow: hidden;
      z-index: 5;
    }

    @media (max-width: 1200px) {
      .sidebar { width: 72px; }
      .sidebar-header { font-size: 0; }
      .sidebar-nav a span, .sidebar-footer a span { display: none; }
      .sidebar-nav a .material-icons, .sidebar-footer a .material-icons { margin: 0 auto; }
      .main { margin-left: 72px; }
      .right-ad { display: none; }
    }
  </style>
</head>
<body>
  <!-- 左侧导航 -->
  <nav class="sidebar">
    <div class="sidebar-header" onclick="showSearch()">导航</div>
    <div class="sidebar-nav">
      <a href="javascript:void(0)" onclick="showSearch()" class="active">
        <span class="material-icons">search</span>
        <span>搜索首页</span>
      </a>
      <div id="categoryMenu"></div>
    </div>
    <!-- 底部固定菜单 -->
    <div class="sidebar-footer">
      <a href="submit.html" target="_blank">
        <span class="material-icons">add_box</span>
        <span>网站提交</span>
      </a>
      <a href="javascript:void(0)" onclick="showFriendly()">
        <span class="material-icons">link</span>
        <span>友情链接</span>
      </a>
      <a href="javascript:void(0)" onclick="showAbout()">
        <span class="material-icons">info</span>
        <span>关于导航</span>
      </a>
    </div>
  </nav>

  <!-- 主内容 -->
  <main class="main">
    <div class="top-bar">
      <div class="top-ad">
        <ins class="adsbygoogle"
             style="display:inline-block;width:728px;height:90px"
             data-ad-client="ca-pub-9474229114991789"
             data-ad-format="auto"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </div>

    <div class="content" id="content">
      <!-- 默认搜索首页 -->
      <div class="search-home">
        <div class="search-box">
          <input type="text" class="search-input" placeholder="请输入搜索内容..." id="searchQuery" onkeydown="if(event.keyCode==13) doSearch()">
          <select class="search-select" id="searchEngine">
            <option value="baidu">百度</option>
            <option value="google">Google</option>
            <option value="bing">Bing</option>
            <option value="so">360搜索</option>
          </select>
          <button class="search-btn" onclick="doSearch()">搜索</button>
        </div>
      </div>
    </div>
  </main>

  <!-- 右侧广告 -->
  <div class="right-ad">
    <ins class="adsbygoogle"
         style="display:inline-block;width:300px;height:600px"
         data-ad-client="ca-pub-9474229114991789"
         data-ad-format="auto"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <script>
    let categories = [];

    async function loadData() {
      try {
        const res = await fetch('/api/data');
        if (!res.ok) throw new Error('无法连接服务器');
        const xml = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, 'text/xml');

        categories = Array.from(doc.querySelectorAll('category')).map(cat => ({
          name: cat.getAttribute('name') || '未命名分类',
          subcategories: Array.from(cat.querySelectorAll('subcategory')).map(sub => ({
            name: sub.getAttribute('name') || '未命名子分类',
            links: Array.from(sub.querySelectorAll('link')).map(l => ({
              name: l.getAttribute('name') || '未命名链接',
              url: l.getAttribute('url') || '#',
              desc: l.getAttribute('desc') || '',
              icon: l.getAttribute('icon') || ''
            }))
          })) || []
        }));

        renderMenu();
        showSearch();
      } catch (e) {
        document.getElementById('content').innerHTML = `
          <div style="text-align:center;padding:100px;color:#c5221f;">
            <h2>加载失败</h2>
            <p>无法读取导航数据，请稍后重试或联系管理员。</p>
            <p>错误：${e.message}</p>
          </div>`;
      }
    }

    function renderMenu() {
      const menu = document.getElementById('categoryMenu');
      menu.innerHTML = '';
      categories.forEach((cat, idx) => {
        const a = document.createElement('a');
        a.href = 'javascript:void(0)';
        a.innerHTML = `<span class="material-icons">folder</span><span>${cat.name}</span>`;
        a.onclick = () => showCategory(idx);
        menu.appendChild(a);
      });
    }

    function showSearch() {
      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      document.querySelector('.sidebar-nav a:first-child').classList.add('active');

      document.getElementById('content').innerHTML = `
        <div class="search-home">
          <div class="search-box">
            <input type="text" class="search-input" placeholder="请输入搜索内容..." id="searchQuery" onkeydown="if(event.keyCode==13) doSearch()">
            <select class="search-select" id="searchEngine">
              <option value="baidu">百度</option>
              <option value="google">Google</option>
              <option value="bing">Bing</option>
              <option value="so">360搜索</option>
            </select>
            <button class="search-btn" onclick="doSearch()">搜索</button>
          </div>
        </div>
      `;
    }

    function doSearch() {
      const q = document.getElementById('searchQuery')?.value.trim();
      if (!q) return;
      const engine = document.getElementById('searchEngine').value;
      let url = '';
      switch(engine) {
        case 'baidu': url = 'https://www.baidu.com/s?wd=' + encodeURIComponent(q); break;
        case 'google': url = 'https://www.google.com/search?q=' + encodeURIComponent(q); break;
        case 'bing': url = 'https://www.bing.com/search?q=' + encodeURIComponent(q); break;
        case 'so': url = 'https://www.so.com/s?q=' + encodeURIComponent(q); break;
      }
      window.open(url, '_blank');
    }

    function showCategory(idx) {
      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      event.target.closest('a').classList.add('active');

      const cat = categories[idx];
      let html = '';

      cat.subcategories.forEach(sub => {
        if (sub.links.length > 0) {
          html += `<div class="subcategory-title">${sub.name}</div><div class="links-grid">`;
          sub.links.forEach(link => {
            html += `<div class="link-card">
              ${link.icon ? `<img src="${link.icon}" alt="${link.name}">` : '<img src="https://via.placeholder.com/48?text=ICON" alt="默认图标">'}
              <a href="${link.url}" target="_blank">${link.name}</a>
              <div class="desc">${link.desc || '暂无描述'}</div>
            </div>`;
          });
          html += `</div>`;
        }
      });

      document.getElementById('content').innerHTML = html || '<div style="text-align:center;padding:100px;color:#5f6368;">该分类暂无内容</div>';
    }

    function showFriendly() {
      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      event.target.closest('a').classList.add('active');

      document.getElementById('content').innerHTML = `
        <div style="text-align:center;padding:100px;">
          <h2 style="font-size:28px;color:#333;">友情链接</h2>
          <p style="color:#5f6368;font-size:16px;">暂无友情链接，欢迎交换！</p>
        </div>
      `;
    }

    function showAbout() {
      document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
      event.target.closest('a').classList.add('active');

      document.getElementById('content').innerHTML = `
        <div style="text-align:center;padding:100px;">
          <h2 style="font-size:28px;color:#333;">关于导航</h2>
          <p style="color:#5f6368;font-size:16px;max-width:800px;margin:30px auto;line-height:1.8;">
            吾爱三三两两导航站是一个实用资源集合网站，致力于提供优质工具、学习资源和常用链接。<br><br>
            版本：1.0 | 更新日期：2025-12-14
          </p>
        </div>
      `;
    }

    loadData();
  </script>
</body>
</html>

/* 广告与卡片样式保持不变 */
.ad-box{margin:32px 0;padding:16px;background:#fff;border:1px solid #dadce0;border-radius:8px;text-align:center;box-shadow:0 1px 2px 0 rgba(60,64,67,0.3);}
.category-title{font-size:28px;font-weight:500;color:#202124;margin-bottom:8px;}
.sub-title{font-size:18px;color:#5f6368;margin:24px 0 12px;font-weight:500;}
.links{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;}
.card{display:flex;align-items:center;padding:16px;background:#fff;border-radius:12px;text-decoration:none;color:inherit;box-shadow:0 1px 2px 0 rgba(60,64,67,0.3),0 2px 6px 2px rgba(60,64,67,0.15);transition:all 0.2s;height:96px;}
.card:hover{box-shadow:0 4px 8px 0 rgba(60,64,67,0.3),0 8px 20px 4px rgba(60,64,67,0.15);transform:translateY(-2px);}
.card img{width:48px;height:48px;min-width:48px;min-height:48px;object-fit:contain;background:#f8f9fa;border-radius:8px;padding:4px;}
.text{margin-left:16px;overflow:hidden;}
.name{font-size:15px;font-weight:500;color:#202124;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.desc{font-size:13px;color:#5f6368;white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-top:4px;}
iframe#external-frame{flex:1;width:100%;border:none;display:block;}

/* 移动端适配 */
@media (max-width:768px){
  #sidebar{
    position:fixed;
    top:0;
    left:0;
    height:100%;
    width:280px;
    z-index:200;
    transform:translateX(-100%);
  }
  #sidebar.visible{
    transform:translateX(0);
  }
  #sidebar.visible{transform:translateX(0);}
  #hamburger{display:flex;}
  body.sidebar-open #overlay{display:block;}
  #ad-top{padding-left:60px;}
  #search-page{padding-top:80px;}
}
</style>
</head>

<body>
<div id="layout">
  <div id="sidebar">
@@ -160,9 +159,7 @@
  <div id="main">
    <div id="overlay" onclick="toggleSidebar()"></div>
    <div id="hamburger" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
      <span></span><span></span><span></span>
    </div>
    <div id="ad-top">
      <ins class="adsbygoogle" style="display:block"
@@ -184,7 +181,22 @@
    <div id="content"></div>
  </div>
</div>

<script>
/* ===== ★ favicon 分流新增（仅新增，不影响原逻辑） ===== */
let isChinaMainland = false;
fetch('https://ipapi.co/json/')
  .then(r=>r.json())
  .then(d=>{ if(d && d.country_code==='CN') isChinaMainland=true; })
  .catch(()=>{});

const FAVICON_GOOGLE='https://www.google.com/s2/favicons?sz=64&domain=';
const FAVICON_CN='https://gstatic.loli.net/s2/favicons?sz=64&domain=';
function getFavicon(domain){
  return (isChinaMainland?FAVICON_CN:FAVICON_GOOGLE)+domain;
}
/* ===== favicon 分流新增结束 ===== */

const API='/api/data';
let engine='https://www.google.com/search?q=';
let data;
@@ -216,11 +228,11 @@

function renderCats(){
  const box=document.getElementById('cats'); box.innerHTML='';
  data.forEach((c, idx)=>{
  data.forEach((c)=>{
    const d=document.createElement('div');
    d.className='cat';
    d.textContent=c.name;
    d.onclick=() => {
    d.onclick=()=>{
      document.querySelectorAll('.cat').forEach(cat=>cat.classList.remove('active'));
      d.classList.add('active');
      showCategory(c);
@@ -260,55 +272,55 @@
      const a=document.createElement('a'); a.className='card'; a.href=l.url; a.target='_blank';
      const img=document.createElement('img');
      if (l.icon && l.icon.trim()) img.src=l.icon.trim();
      else img.src=`https://www.google.com/s2/favicons?sz=64&domain=${getDomain(l.url)}`;
      else img.src=getFavicon(getDomain(l.url)); /* ★ 唯一替换点 */
      img.onerror=()=>{ img.onerror=null; img.src=DEF_ICON; };
      const t=document.createElement('div'); t.className='text';
      t.innerHTML=`<div class="name">${l.name}</div><div class="desc">${l.desc||''}</div>`;
      a.appendChild(img); a.appendChild(t); box.appendChild(a);
    });
    if(i===0){
      cont.innerHTML+=`<div class="ad-box">
        <ins class="adsbygoogle" style="display:block"
          data-ad-client="ca-pub-9474229114991789"
          data-ad-slot="1122334455"
          data-ad-format="auto"></ins></div>`;
      (adsbygoogle=window.adsbygoogle||[]).push({});
    }
  });
  document.getElementById('logo').classList.add('return-mode');
  closeSidebarOnMobile();
}

function backToSearch(){
  document.getElementById('content').style.display='none';
  document.getElementById('search-page').style.display='flex';
  document.getElementById('logo').classList.remove('return-mode');
  document.querySelectorAll('.cat').forEach(cat=>cat.classList.remove('active'));
  closeSidebarOnMobile();
}

function loadExternal(url){
  document.getElementById('search-page').style.display='none';
  const content=document.getElementById('content');
  content.innerHTML='<iframe id="external-frame"></iframe>';
  content.style.display='flex';
  document.getElementById('external-frame').src=url;
  document.getElementById('logo').classList.add('return-mode');
  document.querySelectorAll('.cat').forEach(cat=>cat.classList.remove('active'));
  closeSidebarOnMobile();
}

function toggleSidebar(){
  sidebar.classList.toggle('visible');
  document.body.classList.toggle('sidebar-open');
}

function closeSidebarOnMobile(){
  if(window.innerWidth <= 768){
    sidebar.classList.remove('visible');
    document.body.classList.remove('sidebar-open');
  }
}
</script>
</body>
</html>

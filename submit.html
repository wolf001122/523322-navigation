<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>网站提交</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#f8f9fa;
  color:#202124;
}
.submit-box{
  max-width:720px;
  margin:0 auto;
  background:#fff;
  padding:32px;
  border-radius:12px;
  box-shadow:0 1px 3px rgba(60,64,67,.3),0 4px 12px rgba(60,64,67,.15);
}
h1{
  font-size:24px;
  margin-bottom:24px;
}
.form-row{
  margin-bottom:18px;
}
label{
  display:block;
  font-size:14px;
  color:#5f6368;
  margin-bottom:6px;
}
input,select,textarea{
  width:100%;
  padding:12px;
  border:1px solid #dadce0;
  border-radius:8px;
  font-size:14px;
}
textarea{resize:vertical;min-height:80px}
button{
  padding:12px 24px;
  border:none;
  border-radius:24px;
  background:#1a73e8;
  color:#fff;
  font-size:15px;
  cursor:pointer;
}
button:hover{opacity:.9}
.notice{
  font-size:13px;
  color:#5f6368;
  margin-bottom:16px;
}
.captcha{
  display:flex;
  gap:12px;
  align-items:center;
}
.captcha span{
  font-weight:600;
}
.error{
  color:#d93025;
  font-size:13px;
}
.success{
  color:#188038;
  font-size:14px;
}
</style>
</head>

<body>

<div class="submit-box">
  <h1>网站提交</h1>
  <div class="notice">
    请填写真实有效的网站信息，审核通过后将显示在导航中。
  </div>

  <div class="form-row">
    <label>一级分类</label>
    <select id="cat1">
      <option value="">请选择一级分类</option>
    </select>
  </div>

  <div class="form-row">
    <label>二级分类</label>
    <select id="cat2" disabled>
      <option value="">请先选择一级分类</option>
    </select>
  </div>

  <div class="form-row">
    <label>网站名称</label>
    <input id="name" placeholder="例如：百度">
  </div>

  <div class="form-row">
    <label>网站网址</label>
    <input id="url" placeholder="https://www.example.com">
  </div>

  <div class="form-row">
    <label>网站简介</label>
    <textarea id="desc" placeholder="一句话介绍，不超过50字"></textarea>
  </div>

  <div class="form-row captcha">
    <span id="captcha-q"></span>
    <input id="captcha-a" placeholder="答案">
  </div>

  <div class="form-row">
    <button onclick="submitSite()">提交审核</button>
  </div>

  <div id="msg"></div>
</div>

<script>
const API='/api/data';
let categories=[];
let captchaAnswer=0;

/* ========= 加载分类 ========= */
fetch(API).then(r=>r.text()).then(t=>{
  const xml=new DOMParser().parseFromString(t,'text/xml');
  categories=[...xml.querySelectorAll('category')].map(c=>({
    name:c.getAttribute('name'),
    subs:[...c.querySelectorAll('subcategory')].map(s=>s.getAttribute('name'))
  }));
  const c1=document.getElementById('cat1');
  categories.forEach((c,i)=>{
    const o=document.createElement('option');
    o.value=i;
    o.textContent=c.name;
    c1.appendChild(o);
  });
});

/* ========= 一级 → 二级 ========= */
document.getElementById('cat1').onchange=e=>{
  const c2=document.getElementById('cat2');
  c2.innerHTML='';
  if(e.target.value===''){
    c2.disabled=true;
    c2.innerHTML='<option>请先选择一级分类</option>';
    return;
  }
  c2.disabled=false;
  c2.innerHTML='<option value="">请选择二级分类</option>';
  categories[e.target.value].subs.forEach(s=>{
    const o=document.createElement('option');
    o.value=s;
    o.textContent=s;
    c2.appendChild(o);
  });
};

/* ========= 验证码 ========= */
function newCaptcha(){
  const a=Math.floor(Math.random()*10+1);
  const b=Math.floor(Math.random()*10+1);
  captchaAnswer=a+b;
  document.getElementById('captcha-q').textContent=`验证：${a} + ${b} = ?`;
}
newCaptcha();

/* ========= 提交 ========= */
function submitSite(){
  const msg=document.getElementById('msg');
  msg.innerHTML='';

  const cat1=document.getElementById('cat1').value;
  const cat2=document.getElementById('cat2').value;
  const name=document.getElementById('name').value.trim();
  const url=document.getElementById('url').value.trim();
  const desc=document.getElementById('desc').value.trim();
  const cap=document.getElementById('captcha-a').value.trim();

  if(!cat1||!cat2||!name||!url){
    msg.innerHTML='<div class="error">请完整填写所有必填项</div>';
    return;
  }
  if(!/^https?:\/\//.test(url)){
    msg.innerHTML='<div class="error">网址必须以 http 或 https 开头</div>';
    return;
  }
  if(Number(cap)!==captchaAnswer){
    msg.innerHTML='<div class="error">验证码错误</div>';
    newCaptcha();
    return;
  }

  /* 这里预留提交接口 */
  console.log({
    category:categories[cat1].name,
    subcategory:cat2,
    name,url,desc
  });

  msg.innerHTML='<div class="success">提交成功，等待审核</div>';
  newCaptcha();
}
</script>

</body>
</html>

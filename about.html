<div style="padding:24px; max-width:800px; margin:0 auto; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif; color:#202124;">

  <!-- 关于导航卡片 -->
  <div style="background:#fff; padding:24px; border-radius:12px; box-shadow:0 2px 6px rgba(60,64,67,0.15); margin-bottom:32px;">
    <h2 style="font-size:28px; font-weight:500; color:#202124; margin-bottom:16px;">关于导航</h2>
    <p style="font-size:16px; color:#5f6368; line-height:1.8; margin-bottom:12px;">
      本站致力于收录优质、常用的网站资源。
    </p>
    <p style="font-size:16px; color:#5f6368; line-height:1.8; margin-bottom:12px;">
      所有网站均来源于人工整理与用户提交，经审核后上线。
    </p>
    <p style="font-size:16px; color:#5f6368; line-height:1.8;">
      如发现不良内容，可联系我们处理。
    </p>
  </div>

  <!-- 在线联系表单卡片 -->
  <div style="background:#fff; padding:24px; border-radius:12px; box-shadow:0 2px 6px rgba(60,64,67,0.15);">
    <h2 style="font-size:24px; font-weight:500; color:#202124; margin-bottom:16px;">在线联系</h2>
    <form id="feedbackForm">
      <label style="display:block; margin-bottom:8px; color:#5f6368;">您的建议或反馈</label>
      <textarea id="message" required placeholder="请输入您的建议…" style="width:100%; padding:12px; border:1px solid #dadce0; border-radius:8px; font-size:16px; resize:vertical; min-height:100px;"></textarea>

      <label style="display:block; margin:12px 0 8px; color:#5f6368;">联系方式（可选）</label>
      <input id="contact" type="text" placeholder="邮箱或手机号" style="width:100%; padding:12px; border:1px solid #dadce0; border-radius:8px; font-size:16px;">

      <!-- 简单数学验证码 -->
      <div style="margin-top:12px; display:flex; align-items:center;">
        <label id="captchaQuestion" style="margin-right:8px; white-space:nowrap;"></label>
        <input id="captchaAnswer" type="text" required placeholder="答案" style="width:80px; padding:8px; border:1px solid #dadce0; border-radius:4px; font-size:16px;">
      </div>

      <button type="submit" style="margin-top:24px; width:100%; padding:12px; background:#1a73e8; color:#fff; border:none; border-radius:8px; font-size:16px; cursor:pointer;">提交</button>
      <div id="feedbackMsg" style="margin-top:12px; text-align:center; color:#1a73e8;"></div>
    </form>
  </div>
</div>

<script>
let captchaNum1, captchaNum2, captchaAnswer;

// 生成随机数学验证码
function generateCaptcha() {
  captchaNum1 = Math.floor(Math.random() * 10) + 1;
  captchaNum2 = Math.floor(Math.random() * 10) + 1;
  captchaAnswer = captchaNum1 + captchaNum2;
  document.getElementById('captchaQuestion').textContent = `${captchaNum1} + ${captchaNum2} = ?`;
}

// 初始化验证码
generateCaptcha();

// 表单提交处理
document.getElementById('feedbackForm').onsubmit = async function(e) {
  e.preventDefault();
  const userAnswer = parseInt(document.getElementById('captchaAnswer').value, 10);
  if (userAnswer !== captchaAnswer) {
    alert('验证码错误，请重新输入！');
    generateCaptcha();
    return;
  }

  const data = {
    message: document.getElementById('message').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    time: new Date().toISOString()
  };

  if (!data.message) {
    alert('请填写您的建议内容！');
    return;
  }

  try {
    // 保存到 KV，键名：user_feedback
    await fetch('/api/kv/NAV_DATA/user_feedback', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    document.getElementById('feedbackMsg').textContent = '提交成功，感谢您的反馈！';
    this.reset();
    generateCaptcha();
  } catch (err) {
    console.error(err);
    document.getElementById('feedbackMsg').textContent = '提交失败，请稍后再试。';
  }
};
</script>

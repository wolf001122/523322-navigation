<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š Traffic Signal åå°æµ‹è¯•å±•ç¤ºé¡µ</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
  h1 { font-size: 24px; margin-bottom: 10px; }
  table { border-collapse: collapse; width: 100%; background: #fff; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #eee; }
  .placeholder { color: #999; }
  .updated { color: #090; font-weight: bold; }
</style>
</head>
<body>

<h1>ğŸ“Š Traffic Signal åå°æµ‹è¯•å±•ç¤ºé¡µ</h1>
<p>æœ¬é¡µé¢ä»…ç”¨äºè§‚å¯Ÿ <code>traffic-signal-worker</code> è¾“å‡ºç»“æœï¼Œä¸åšä»»ä½•ä¿®æ­£ï¼Œä»…ä¾›äººå·¥è¯„ä¼°ã€‚</p>

<table id="traffic-table">
  <thead>
    <tr>
      <th>ç½‘ç«™</th>
      <th>åŸŸå</th>
      <th>ç­‰çº§</th>
      <th>åŒºé—´</th>
      <th>ç´¢å¼•é¡µ</th>
      <th>é¦–é¡µå¯è¾¾</th>
      <th>é¡µé¢å¤§å°(KB)</th>
      <th>æ›´æ–°æ—¶é—´</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="8" style="color:#999;">æ•°æ®åŠ è½½ä¸­...</td></tr>
  </tbody>
</table>

<p>æ•°æ®æ¥æºï¼š<a href="https://523322.xyz/traffic_snapshot" target="_blank">traffic-signal-worker</a></p>

<script>
const WORKER_URL = "https://523322.xyz/traffic_snapshot"; // å¿…é¡»æ˜¯ç»å¯¹ URL

// æ¸²æŸ“è¡¨æ ¼
function renderTable(data) {
  const tbody = document.querySelector("#traffic-table tbody");
  tbody.innerHTML = "";
  data.forEach(site => {
    const isPlaceholder = site.signals.index_pages === 0;
    const tr = document.createElement("tr");
    tr.className = isPlaceholder ? "placeholder" : "updated";
    tr.innerHTML = `
      <td>${site.name}</td>
      <td>${site.domain}</td>
      <td>${site.traffic_level}</td>
      <td>${site.traffic_range}</td>
      <td>${site.signals.index_pages}</td>
      <td>${site.signals.homepage_ok ? "âœ”" : "âœ–"}</td>
      <td>${site.signals.page_size_kb}</td>
      <td>${site.updated}</td>
    `;
    tbody.appendChild(tr);
  });
}

// åŠ è½½æ•°æ®
async function loadTrafficData() {
  try {
    const resp = await fetch(WORKER_URL);
    if (!resp.ok) throw new Error("Worker è¿”å›é”™è¯¯: " + resp.status);
    const data = await resp.json();
    renderTable(data);
  } catch (e) {
    console.log("åŠ è½½æ•°æ®å¤±è´¥:", e);
    const tbody = document.querySelector("#traffic-table tbody");
    tbody.innerHTML = `<tr><td colspan="8" style="color:#999;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨å€™åˆ·æ–°</td></tr>`;
  }
}

// é¡µé¢é¦–æ¬¡åŠ è½½
loadTrafficData();

// æ¯ 3 ç§’åˆ·æ–°ä¸€æ¬¡
setInterval(loadTrafficData, 3000);
</script>

</body>
</html>

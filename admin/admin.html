<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理后台 - 网址导航</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    /* 同前样式... */
  </style>
</head>
<body>
  <!-- 同前 HTML 结构... -->

  <script>
    class NavigationManager {
      // 同前代码...

      showModal(type, catIdx = -1, linkIdx = -1) {
        // 同前...

        if (type === 'link') {
          // 同前...
          this.formFields.innerHTML += `
            <div class="form-group">
              <label>图标上传（可选，建议 60x60 PNG）</label>
              <input type="file" id="linkIconFile" accept="image/png,image/jpeg">
              <p style="font-size:12px; color:#666;">或输入 URL： <input type="url" id="linkIcon" value="${link.icon || ''}" placeholder="https://example.com/logo.png"></p>
            </div>
          `;
        }
      }

      async saveItem(type) {
        if (type === 'link') {
          // 同前...
          let icon = document.getElementById('linkIcon').value.trim();
          const file = document.getElementById('linkIconFile').files[0];
          if (file) {
            const formData = new FormData();
            formData.append('file', file);
            const res = await fetch('/api/upload', { method: 'POST', body: formData });
            if (res.ok) icon = await res.text();
            else return alert('图标上传失败');
          }
          const link = { name, url, desc, icon };
          // 同前...
        }
        // 同前...
      }

      // 同前 saveToKV 添加 icon 到 XML...
      xml += `    <link name="${this.escapeXml(link.name)}" url="${this.escapeXml(link.url)}"${desc} icon="${this.escapeXml(link.icon)}"/>\n`;
    }

    const navMgr = new NavigationManager();
    navMgr.init();
  </script>
</body>
</html>

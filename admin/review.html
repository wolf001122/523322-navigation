<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>待审核网站提交</title>
<style>
body {font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #f8f9fa; color: #202124;}
h1 {font-size: 24px; margin-bottom: 20px;}
.item {border: 1px solid #dadce0; margin: 15px 0; padding: 15px; border-radius: 8px; background: #fff; box-shadow: 0 1px 2px rgba(60,64,67,0.3);}
.item p {margin: 8px 0;}
button {padding: 8px 16px; margin-right: 10px; border: none; border-radius: 4px; cursor: pointer;}
.approve {background: #1a73e8; color: #fff;}
.delete {background: #f44336; color: #fff;}
#msg {color: #d93025; margin-top: 20px;}
</style>
</head>
<body>
<h1>待审核网站提交</h1>
<div id="list">加载中...</div>
<div id="msg"></div>

<script>
function loadPending() {
  fetch('/api/pending')
    .then(r => {
      if (!r.ok) throw new Error('加载失败');
      return r.json();
    })
    .then(list => {
      const div = document.getElementById('list');
      if (list.length === 0) {
        div.innerHTML = '<p>暂无待审核提交</p>';
        return;
      }
      div.innerHTML = '';
      list.forEach(site => {
        const item = document.createElement('div');
        item.className = 'item';
        item.innerHTML = `
          <p><strong>网站名称：</strong>${site.name}</p>
          <p><strong>URL：</strong><a href="${site.url}" target="_blank">${site.url}</a></p>
          <p><strong>分类：</strong>${site.cat1} > ${site.cat2}</p>
          <p><strong>简介：</strong>${site.desc}</p>
          <p><strong>提交时间：</strong>${new Date(site.time).toLocaleString()}</p>
          <button class="approve" onclick="review(${site.id}, 'approve')">通过并上线</button>
          <button class="delete" onclick="review(${site.id}, 'delete')">删除</button>
        `;
        div.appendChild(item);
      });
    })
    .catch(err => {
      document.getElementById('list').innerHTML = '<p style="color:red">加载失败：' + err.message + '</p>';
    });
}

function review(id, action) {
  if (!confirm(action === 'approve' ? '确认通过并上线此网站？' : '确认删除此提交？')) return;

  fetch('/api/approve', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({id, action})
  })
  .then(r => r.text())
  .then(msg => {
    alert(msg);
    loadPending();  // 刷新列表
  })
  .catch(err => alert('操作失败：' + err.message));
}

// 初始加载 + 每30秒自动刷新
loadPending();
setInterval(loadPending, 30000);
</script>
</body>
</html>
